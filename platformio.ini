# ============================================================================
# PlatformIO Configuration for ESP32-WROOM-32 Modbus RTU Server
# ============================================================================

[env:esp32]
platform = espressif32
board = esp32doit-devkit-v1
framework = arduino
monitor_speed = 115200
upload_speed = 921600

# Auto-generate build info before each build
extra_scripts = pre:scripts/generate_build_info.py

# ============================================================================
# SERIAL PORT CONFIGURATION
# ============================================================================
# COM11 for your ESP32 (auto-detect)
monitor_port = COM11

# ============================================================================
# BUILD FLAGS
# ============================================================================
build_flags =
  -Wall
  -Wextra
  -std=c99
  -DESP32
  -DCORE_DEBUG_LEVEL=CORE_DEBUG_LEVEL_INFO
  -DLOG_LOCAL_LEVEL=ESP_LOG_INFO

# ============================================================================
# LIBRARY DEPENDENCIES
# ============================================================================
# Using Arduino-ESP32 core with built-in ESP-IDF Wi-Fi/networking support
lib_deps =
  # Wi-Fi and networking (built-in to ESP-IDF)
  # No external dependencies needed - uses lwIP sockets and ESP-IDF WiFi API

# ============================================================================
# NOTE: Project structure uses PlatformIO defaults:
#   - src/     (source files)
#   - include/ (header files)
#   - test/    (unit tests)
# ============================================================================

# ============================================================================
# MONITOR SETTINGS
# ============================================================================
# Auto-enter bootloader on upload
monitor_filters = esp32_exception_decoder
monitor_echo = no
monitor_eol = LF

# ============================================================================
# ADVANCED SETTINGS
# ============================================================================
# Custom partition table with larger NVS (64KB) for ST Logic programs
# NOTE: Cannot use 64KB NVS because app0 MUST start at 0x10000
# Solution: Move ST Logic storage to SPIFFS (requires code changes)
# board_build.partitions = partitions.csv

# Flash settings
board_build.flash_size = 4MB
board_build.flash_freq = 80m
board_build.flash_mode = dio

# Verbose output for debugging med de hw counter som er oi spil, de tæller tilsyndeladene ikke præsigtsdsdsdsad
# build_type = debug
